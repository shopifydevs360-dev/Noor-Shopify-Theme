{{ 'collection-tab.css' | asset_url | stylesheet_tag }}

<section class="product-tabs-carousel">
  <div class="product-tabs-inner">

    <!-- ===== TABS ===== -->
    <div class="product-tabs">
      {% for block in section.blocks %}
        <button
          class="product-tab {% if forloop.first %}is-active{% endif %}"
          data-tab="{{ block.settings.collection.handle }}"
        >
          {{ block.settings.tab_label }}
        </button>
      {% endfor %}
    </div>

    <!-- ===== MAIN LAYOUT ===== -->
    <div class="product-tabs-container">

      <!-- ===== LEFT LEAD (DESKTOP) ===== -->
      <div class="product-tabs-header hide-tablet-down">
        <h2 class="section-title">
          {{ section.settings.title }}
        </h2>

        {% if section.settings.title_link != blank %}
          <a href="{{ section.settings.title_link }}" class="arrow-link">
            SHOP NOW
            <span class="icon">
              {%- render 'theme-icon', icon: 'right-arrow' -%}
            </span>
          </a>
        {% endif %}
      </div>

      <!-- ===== PRODUCTS ===== -->
      <div class="product-tabs-swiper">
        <div class="swiper js-product-swiper">
          <div class="swiper-wrapper">

            {% for block in section.blocks %}
              {% assign collection = collections[block.settings.collection.handle] %}

              {% for product in collection.products limit: 8 %}
                <div
                  class="swiper-slide product-card-slide"
                  data-collection="{{ collection.handle }}"
                  {% unless forloop.parentloop.first %}hidden{% endunless %}
                >
                  <div class="product-card">

                    <div class="product-image">
                      <a href="{{ product.url }}">
                        <img
                          src="{{ product.featured_image | image_url: width: 600 }}"
                          alt="{{ product.title }}"
                        >
                        {% if product.images[1] %}
                          <img
                            class="hover-image"
                            src="{{ product.images[1] | image_url: width: 600 }}"
                            alt="{{ product.title }}"
                          >
                        {% endif %}
                      </a>
                    </div>

                    <div class="product-info">
                      <div class="split-aligner">
                        <p class="product-title">
                          <a href="{{ product.url }}">{{ product.title }}</a>
                        </p>
                        <p class="product-price">
                          {{ product.price | money }}
                        </p>
                      </div>
                    </div>

                  </div>
                </div>
              {% endfor %}
            {% endfor %}

          </div>
        </div>
      </div>

    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const tabs = document.querySelectorAll('.product-tab');
  const slides = document.querySelectorAll('.product-card-slide');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const handle = tab.dataset.tab;

      tabs.forEach(t => t.classList.remove('is-active'));
      tab.classList.add('is-active');

      slides.forEach(slide => {
        slide.hidden = slide.dataset.collection !== handle;
      });
    });
  });

  new Swiper('.js-product-swiper', {
    slidesPerView: 2,
    spaceBetween: 24,
    breakpoints: {
      768: { slidesPerView: 3 },
      1025: { slidesPerView: 4 }
    }
  });
});
</script>

{% schema %}
{
  "name": "Product Tabs Carousel",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section title",
      "default": "Best Sellers"
    },
    {
      "type": "url",
      "id": "title_link",
      "label": "Title link"
    }
  ],
  "blocks": [
    {
      "type": "tab",
      "name": "Tab",
      "settings": [
        {
          "type": "text",
          "id": "tab_label",
          "label": "Tab label"
        },
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product Tabs Carousel"
    }
  ]
}
{% endschema %}
