{{ 'collection-tab.css' | asset_url | stylesheet_tag }}

<section class="product-tabs-section">
  <div class="product-tabs-container">

    <!-- Header -->
    <div class="product-tabs-header">
      <h2 class="section-title">
        <a href="{{ section.settings.title_link }}">
          {{ section.settings.title }}
        </a>
      </h2>

      <!-- Tabs -->
      <div class="product-tabs">
        {% for block in section.blocks %}
          {% assign collection_handle = block.settings.collection.handle %}
          <button
            class="product-tab{% if forloop.first %} is-active{% endif %}"
            data-collection="{{ collection_handle }}"
          >
            {{ block.settings.tab_label }}
          </button>
        {% endfor %}
      </div>
    </div>

    <!-- Products Slider -->
    <div class="swiper product-tabs-swiper">
      <div class="swiper-wrapper">

        {% for block in section.blocks %}
          {% assign collection = collections[block.settings.collection.handle] %}
          {% if collection and collection.products_count > 0 %}
            {% for product in collection.products limit: 6 %}
              <div
                class="swiper-slide product-card-slide"
                data-collection="{{ collection.handle }}"
                {% unless forloop.parentloop.first %}hidden{% endunless %}
              >
                <div class="product-card">

                  <a href="{{ product.url }}" class="product-image">
                    <img
                      src="{{ product.featured_image | image_url: width: 600 }}"
                      alt="{{ product.title }}"
                      loading="lazy"
                    >
                    {% if product.images[1] %}
                      <img
                        class="hover-image"
                        src="{{ product.images[1] | image_url: width: 600 }}"
                        alt="{{ product.title }}"
                        loading="lazy"
                      >
                    {% endif %}
                  </a>

                  <div class="product-info">
                    <p class="product-title">
                      <a href="{{ product.url }}">{{ product.title }}</a>
                    </p>
                    <p class="product-price">
                      {{ product.price | money }}
                    </p>
                  </div>

                </div>
              </div>
            {% endfor %}
          {% endif %}
        {% endfor %}

      </div>

      <div class="swiper-scrollbar"></div>
    </div>

  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const tabs = document.querySelectorAll('.product-tab');
  const slides = document.querySelectorAll('.product-card-slide');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const collection = tab.dataset.collection;

      tabs.forEach(t => t.classList.remove('is-active'));
      tab.classList.add('is-active');

      slides.forEach(slide => {
        slide.hidden = slide.dataset.collection !== collection;
      });
    });
  });

  new Swiper('.product-tabs-swiper', {
    slidesPerView: 1.2,
    spaceBetween: 16,
    scrollbar: {
      el: '.swiper-scrollbar',
      draggable: true,
    },
    breakpoints: {
      768: {
        slidesPerView: 3,
      },
      1024: {
        slidesPerView: 4,
      }
    }
  });
});
</script>

{% schema %}
{
  "name": "Collections Tabs",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Best Sellers"
    },
    {
      "type": "url",
      "id": "title_link",
      "label": "Title Link"
    }
  ],
  "blocks": [
    {
      "type": "tab",
      "name": "Tab",
      "settings": [
        {
          "type": "text",
          "id": "tab_label",
          "label": "Tab Label"
        },
        {
          "type": "url",
          "id": "tab_link",
          "label": "Tab Collection Link"
        },
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        }
      ]
    }
  ],
  "max_blocks": 10,
  "presets": [
    {
      "name": "Product Tabs Carousel",
      "category": "Custom"
    }
  ]
}
{% endschema %}
