{{ 'collection-tab.css' | asset_url | stylesheet_tag: preload: true }}

<div class="shopify-section product-tabs-carousel">
  <div class="js-product-carousel product-carousel padded ">
    
    <h2 class="sh-container show-tablet-down">
      <a href="{{ section.settings.title_link }}" aria-label="Link to {{ section.settings.title_link }}">
        <div data-reveal="lines-masked">{{ section.settings.title }}</div>
      </a>
    </h2>

    <!-- Filter Tabs -->
    <div class="swiper-container swiper-container-filter scroll-enter">
      <div class="swiper-wrapper">
        {% for block in section.blocks %}
          {% assign collection_handle = block.settings.collection.handle %}
          <div class="related-product-caps swiper-slide">
            <a href="{{ block.settings.tab_link }}" aria-label="Link to {{ block.settings.tab_link }}"
               class="js-slider-filter"
               data-filter="{{ collection_handle }}">
              {{ block.settings.tab_label }}
            </a>
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- Products Carousel -->
    <div class="swiper-container swiper-container-product swiper-has-scrollbar js-animate">
      <div class="swiper-wrapper">
        <!-- Optional Lead Card -->
        <div class="swiper-slide v-aligner hide-tablet-down">
          <div class="collection-lead-info">
            <h2 class="hd-3">
              <a href="{{ section.settings.title_link }}" aria-label="Link to {{ section.settings.title_link }}">
                <div data-reveal="lines-masked">{{ section.settings.title }}</div>
              </a>
            </h2>
            <a href="{{ section.settings.title_link }}" class="arrow-link" data-anim="slide" data-anim-order="3">
              SHOP NOW
            <span class="icon">{%- render 'theme-icon', icon: 'right-arrow' -%}</span>
            </a>
          </div>
        </div>

        <!-- Products from Each Collection -->
        {% for block in section.blocks %}
          {% assign collection = collections[block.settings.collection.handle] %}
          {% if collection.products_count > 0 %}
            {% for product in collection.products limit: 6 %}
              <div class="swiper-slide product-slide" data-collections="{{ collection.handle }}">
                <div class="product-card">
                  <div class="image-wrap">
                    <a href="{{ product.url }}">
                      <div class="cropped-image-wrapper">
                        <img
                          src="{{ product.featured_image | img_url: '600x' }}"
                          alt="{{ product.title }}"
                        >
                        {% if product.images[1] %}
                          <img
                            class="hover-img"
                            src="{{ product.images[1] | img_url: '600x' }}"
                            alt="{{ product.title }} hover image"
                          >
                        {% endif %}
                      </div>
                    </a>

                    <div class="ajax-quick-add-wrapper">
                      {% if product.variants.size > 1 %}
                        <div class="variants-outer-wrapper">
                          <div class="variants-wrapper">
                            {% for variant in product.variants %}
                              <button type="button"
                                      class="js-quick-add-to-cart text-only variant-btn split-aligner js-quick-add-to-cart--full-width{% unless variant.available %} disabled{% endunless %}"
                                      data-action-detail="{{ variant.id }}"
                                      data-variant-id="{{ variant.id }}"
                                      aria-label="Add variant to cart"
                                      {% unless variant.available %}disabled{% endunless %}>
                                <div>{{ variant.title }}&nbsp; &nbsp;{{ variant.price | money }}</div>
                              </button>
                            {% endfor %}
                          </div>
                          <button type="button" class="text-only cta-btn" style="width: 100%; text-align: center;">
                            Make Selection
                          </button>
                        </div>
                      {% else %}
                        <form method="post" action="/cart/add">
                          <input type="hidden" name="id" value="{{ product.variants.first.id }}">
                          {% assign variant = product.variants.first %}
                          <button
                            data-action-detail="{{ variant.id }}"
                            data-variant-id="{{ variant.id }}"
                            type="submit"
                            class="js-quick-add-to-cart event_buy_now_add_to_cart cta-btn text-only js-quick-add-to-cart--full-width"
                            {% unless variant.available %}disabled{% endunless %}
                          >
                            {% if variant.available %}
                              Add to bag
                            {% else %}
                              Out of stock
                            {% endif %}
                          </button>

                        </form>
                      {% endif %}
                    </div>

                  </div>

                  <div class="product-info">
                    <div class="split-aligner">
                      <p class="title">
                        <a href="{{ product.url }}">{{ product.title }}</a>
                      </p>
                      <p>{{ product.price | money }}</p>
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}
          {% endif %}
        {% endfor %}
      </div>
      <div class="swiper-scrollbar"></div>
    </div>
  </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function () {

  const filterSwiper = new Swiper('.swiper-container-filter', {
    slidesPerView: 'auto',
    spaceBetween: 50,
    freeMode: true
  });

  const productSwiper = new Swiper('.swiper-container-product', {
    slidesPerView: 1.2,
    spaceBetween: 24,
    scrollbar: {
      el: '.swiper-scrollbar',
      draggable: true
    },
    breakpoints: {
      768: { slidesPerView: 2.5 },
      1025: { slidesPerView: 3.5 }
    }
  });

  document.querySelectorAll('.js-slider-filter').forEach(trigger => {
    trigger.addEventListener('click', e => {
      e.preventDefault();

      const filter = trigger.dataset.filter;
      const section = trigger.closest('.js-product-carousel');

      section
        .querySelectorAll('.related-product-caps')
        .forEach(tab => tab.classList.remove('active'));

      trigger.closest('.related-product-caps').classList.add('active');

      const slides = section.querySelectorAll('.product-slide');

      slides.forEach(slide => {
        slide.style.display = 'none';
        slide.querySelectorAll('img').forEach(img =>
          img.classList.add('animate-out')
        );
      });

      const visibleSlides = section.querySelectorAll(
        `.product-slide[data-collections*="${filter}"]`
      );

      visibleSlides.forEach(slide => {
        slide.style.display = '';
        slide.querySelectorAll('img').forEach(img =>
          img.classList.remove('animate-out')
        );
      });

      productSwiper.update();
      productSwiper.slideTo(0);
      productSwiper.scrollbar.updateSize();
    });
  });

});
</script>


{% schema %}
{
  "name": "Collections Tabs",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Best Sellers"
    },
    {
      "type": "url",
      "id": "title_link",
      "label": "Title Link"
    }
  ],
  "blocks": [
    {
      "type": "tab",
      "name": "Tab",
      "settings": [
        {
          "type": "text",
          "id": "tab_label",
          "label": "Tab Label"
        },
        {
          "type": "url",
          "id": "tab_link",
          "label": "Tab Collection Link"
        },
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        }
      ]
    }
  ],
  "max_blocks": 10,
  "presets": [
    {
      "name": "Product Tabs Carousel",
      "category": "Custom"
    }
  ]
}
{% endschema %}
