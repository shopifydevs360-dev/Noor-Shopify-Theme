{{ 'article-wrapper.css' | asset_url | stylesheet_tag: preload: true }}

{% assign blog_object = blogs[section.settings.blog] %}
{% if blog_object.articles.size > 0 %}
  <div id="shopify-section-{{ section.id }}" class="shopify-section">
    <section class="js-pinned-sections featured-articles-modern">
      <div class="section-header sh-container">
        <h2 class="section-title" data-reveal="lines-masked">{{ section.settings.wapper_title }}</h2>
        {% if section.settings.show_view_all %}
          <a href="{{ section.settings.blog.url }}" class="view-all-link" aria-label="View all articles">
            View All
            <svg class="arrow-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path d="M1 8H15M15 8L8 1M15 8L8 15" stroke="currentColor" stroke-width="1.5"/>
            </svg>
          </a>
        {% endif %}
      </div>

      <div class="articles-grid-wrapper">
        <div class="articles-main-grid sh-container-lg">
          {% for article in blog_object.articles limit: section.settings.article_limit %}
            {% assign index = forloop.index0 %}
            <div class="js-pin-panel-wrap article-card {% if forloop.first %}active{% endif %}" data-index="{{ index }}">
              <div class="article-card-inner">
                <div class="article-image-container">
                  <a href="{{ article.url }}" class="article-image-link" aria-label="Read {{ article.title }}">
                    <div class="image-aspect-ratio">
                      {% if article.image %}
                        <img
                          class="lazyload"
                          data-src="{{ article.image | image_url: width: 800 }}"
                          data-sizes="auto"
                          alt="{{ article.image.alt | default: article.title }}"
                          loading="lazy"
                        >
                      {% else %}
                        <div class="placeholder-image">
                          {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
                        </div>
                      {% endif %}
                    </div>
                    <div class="article-badge">
                      <span class="badge-number">{{ forloop.index | prepend: '0' }}</span>
                    </div>
                  </a>
                </div>

                <div class="article-content">
                  <div class="article-meta">
                    {% if section.settings.show_date %}
                      <span class="article-date">{{ article.published_at | time_tag: format: 'month_day_year' }}</span>
                    {% endif %}
                    {% if section.settings.show_author %}
                      <span class="article-author">By {{ article.author }}</span>
                    {% endif %}
                  </div>
                  
                  <a href="{{ article.url }}" class="article-title-link">
                    <h3 class="article-title">{{ article.title }}</h3>
                  </a>
                  
                  {% if section.settings.show_excerpt and article.excerpt_or_content != blank %}
                    <p class="article-excerpt">{{ article.excerpt_or_content | strip_html | truncatewords: 20 }}</p>
                  {% endif %}
                  
                  {% if section.settings.show_tags and article.tags.size > 0 %}
                    <div class="article-tags">
                      {% for tag in article.tags limit: 3 %}
                        <span class="article-tag">{{ tag }}</span>
                      {% endfor %}
                    </div>
                  {% endif %}
                  
                  <a href="{{ article.url }}" class="article-read-more">
                    Read Article
                    <svg class="arrow-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                      <path d="M1 8H15M15 8L8 1M15 8L8 15" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                  </a>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>

        <div class="articles-navigation">
          <div class="navigation-dots">
            {% for article in blog_object.articles limit: section.settings.article_limit %}
              <button class="dot {% if forloop.first %}active{% endif %}" data-index="{{ forloop.index0 }}" aria-label="Go to article {{ forloop.index }}">
                <span class="dot-number">{{ forloop.index | prepend: '0' }}</span>
                <span class="dot-title">{{ article.title | truncatewords: 3 }}</span>
              </button>
            {% endfor %}
          </div>
          
          <div class="navigation-arrows">
            <button class="nav-arrow prev-arrow" aria-label="Previous article">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
            <button class="nav-arrow next-arrow" aria-label="Next article">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </section>
  </div>
{% else %}
  <div class="no-articles sh-container">
    <p>{{ 'templates.article.no_articles' | t }}</p>
  </div>
{% endif %}

<script src="{{ 'article-wrapper.js' | asset_url }}" defer="defer"></script>

{% schema %}
{
  "name": "Modern Articles",
  "settings": [
    {
      "type": "text",
      "id": "wapper_title",
      "label": "Section Title",
      "default": "Featured Stories"
    },
    {
      "type": "blog",
      "id": "blog",
      "label": "Choose a Blog"
    },
    {
      "type": "range",
      "id": "article_limit",
      "label": "Number of articles to show",
      "min": 2,
      "max": 6,
      "step": 1,
      "default": 3
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "Show 'View All' link",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_date",
      "label": "Show date",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_author",
      "label": "Show author",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_excerpt",
      "label": "Show excerpt",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_tags",
      "label": "Show tags",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Modern Articles",
      "category": "Blog"
    }
  ]
}
{% endschema %}