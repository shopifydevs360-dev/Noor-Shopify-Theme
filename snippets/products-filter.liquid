{% comment %}
  Renders the collection filters sidebar or off-canvas panel.
{% endcomment %}

<div class="filters-wrapper" id="filters-wrapper">
  <div class="filters-header">
    <h2 class="h3">{{ 'sections.collection_template.filter_by' | t }}</h2>
    <button class="filters-close-btn" onclick="toggleDesktopFilters()" aria-label="{{ 'accessibility.close' | t }}">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
        <line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <form class="filters-form" id="filters-form">
    <!-- Availability Filter -->
    {% if section.settings.enable_availability_filter %}
      <div class="filter-group">
        <h3>{{ 'sections.collection_template.availability' | t }}</h3>
        <label class="filter-label">
          <input type="checkbox" name="filter.v.availability" value="1" {% if current_tags contains 'filter.v.availability:1' %}checked{% endif %}>
          <span>{{ 'sections.collection_template.in_stock' | t }}</span>
        </label>
      </div>
    {% endif %}

    <!-- Price Filter -->
    {% if section.settings.enable_price_filter %}
      <div class="filter-group">
        <h3>{{ 'sections.collection_template.price' | t }}</h3>
        <div class="price-filter">
          <div class="price-slider">
            <div class="progress"></div>
          </div>
          <div class="range-input">
            <input type="range" class="range-min" min="0" max="{{ collection.products.max_price | money_without_currency | replace: ',', '' }}" value="0" step="10">
            <input type="range" class="range-max" min="0" max="{{ collection.products.max_price | money_without_currency | replace: ',', '' }}" value="{{ collection.products.max_price | money_without_currency | replace: ',', '' }}" step="10">
          </div>
          <div class="price-input">
            <input type="number" class="input-min" value="0" min="0" max="{{ collection.products.max_price | money_without_currency | replace: ',', '' }}">
            <span>-</span>
            <input type="number" class="input-max" value="{{ collection.products.max_price | money_without_currency | replace: ',', '' }}" min="0" max="{{ collection.products.max_price | money_without_currency | replace: ',', '' }}">
          </div>
        </div>
      </div>
    {% endif %}

    <!-- Brand (Vendor) Filter -->
    {% if section.settings.enable_brand_filter %}
      {% assign brand_list = section.settings.specific_brands | split: "," %}
      {% for product in collection.products %}
        {% unless brand_list contains product.vendor %}
          {% assign brand_list = brand_list | append: product.vendor | append: "," %}
        {% endunless %}
      {% endfor %}
      {% assign brands = brand_list | uniq | sort %}
      <div class="filter-group">
        <h3>{{ 'sections.collection_template.brand' | t }}</h3>
        {% for brand in brands %}
          {% assign brand_handle = brand | handle | prepend: 'filter.v.vendor:' %}
          <label class="filter-label">
            <input type="checkbox" name="filter.v.vendor" value="{{ brand | handle }}" {% if current_tags contains brand_handle %}checked{% endif %}>
            <span>{{ brand }}</span>
          </label>
        {% endfor %}
      </div>
    {% endif %}

    <!-- Product Type Filter -->
    {% if section.settings.enable_type_filter %}
      {% assign type_list = section.settings.specific_types | split: "," %}
      {% for product in collection.products %}
        {% unless type_list contains product.type %}
          {% assign type_list = type_list | append: product.type | append: "," %}
        {% endunless %}
      {% endfor %}
      {% assign types = type_list | uniq | sort %}
      <div class="filter-group">
        <h3>{{ 'sections.collection_template.product_type' | t }}</h3>
        {% for type in types %}
          {% assign type_handle = type | handle | prepend: 'filter.p.product_type:' %}
          <label class="filter-label">
            <input type="checkbox" name="filter.p.product_type" value="{{ type | handle }}" {% if current_tags contains type_handle %}checked{% endif %}>
            <span>{{ type }}</span>
          </label>
        {% endfor %}
      </div>
    {% endif %}
    
    <!-- Color Filter (Tag-based) -->
    {% if section.settings.enable_color_filter %}
      {% assign color_list = section.settings.specific_colors | split: "," %}
      {% for product in collection.products %}
        {% for tag in product.tags %}
          {% assign tag_prefix = tag | slice: 0, 6 %}
          {% if tag_prefix == 'color:' %}
            {% assign color_name = tag | remove: 'color:' %}
            {% unless color_list contains color_name %}
              {% assign color_list = color_list | append: color_name | append: "," %}
            {% endunless %}
          {% endif %}
        {% endfor %}
      {% endfor %}
      {% assign colors = color_list | uniq | sort %}
      <div class="filter-group">
        <h3>{{ 'sections.collection_template.color' | t }}</h3>
        {% for color in colors %}
          {% assign color_handle = color | handle | prepend: 'filter.v.tag:' | prepend: 'color:' %}
          <label class="filter-label color-filter-label">
            <input type="checkbox" name="filter.v.tag" value="color:{{ color | handle }}" {% if current_tags contains color_handle %}checked{% endif %}>
            <span class="color-swatch" style="background-color: {{ color | downcase }};"></span>
            <span class="color-name">{{ color }}</span>
          </label>
        {% endfor %}
      </div>
    {% endif %}
  </form>
</div>