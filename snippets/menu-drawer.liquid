{{ 'menu-drawer.css' | asset_url | stylesheet_tag: preload: true }}

<!-- Menu Drawer -->
<div class="drawer drawer--menu {% if settings.enable_rtl %}rtl{% endif %}" id="menu-drawer" role="dialog" aria-modal="true" aria-label="Menu">
  <div class="drawer__overlay" data-drawer-close></div>
  <div class="drawer__inner">

    <!-- Desktop Panels -->
    <div class="drawer__panel drawer__panel--parent">
      <div class="drawer__header">
        <button class="drawer__close" aria-label="Close" data-drawer-close>&times;</button>
      </div>
      <div class="drawer__content">
        <ul class="menu__list menu__list--level-1">
          {% for link in settings.menu.links %}
            <li class="menu__item {% if link.links != blank %}has-children{% endif %}">
              <a href="{{ link.url }}" class="menu__link" data-target-panel="child" data-title="{{ link.title }}">
                {{ link.title }}
                {% if link.links != blank %}
                  <span class="menu__arrow">&rsaquo;</span>
                {% endif %}
              </a>
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>

    <div class="drawer__panel drawer__panel--child">
      <div class="drawer__header">
        <button class="drawer__back" data-back-panel="parent">&larr; Back</button>
        <span class="drawer__panel-title"></span>
      </div>
      <div class="drawer__content">
        <ul class="menu__list menu__list--level-2"></ul>
      </div>
    </div>

    <div class="drawer__panel drawer__panel--grandchild">
      <div class="drawer__header">
        <button class="drawer__back" data-back-panel="child">&larr; Back</button>
        <span class="drawer__panel-title"></span>
      </div>
      <div class="drawer__content">
        <ul class="menu__list menu__list--level-3"></ul>
      </div>
    </div>

  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const drawer = document.getElementById('menu-drawer');
  const panels = drawer.querySelectorAll('.drawer__panel');
  const parentPanel = drawer.querySelector('.drawer__panel--parent');
  const childPanel = drawer.querySelector('.drawer__panel--child');
  const grandchildPanel = drawer.querySelector('.drawer__panel--grandchild');

  // Toggle Drawer
  document.querySelectorAll('[data-drawer-toggle]').forEach(btn => {
    btn.addEventListener('click', function() {
      drawer.classList.add('open');
      document.body.style.overflow = 'hidden';
      showPanel(parentPanel);
    });
  });

  document.querySelectorAll('[data-drawer-close]').forEach(btn => {
    btn.addEventListener('click', function() {
      drawer.classList.remove('open');
      document.body.style.overflow = '';
      panels.forEach(p => p.classList.remove('active'));
    });
  });

  // Back buttons
  drawer.querySelectorAll('.drawer__back').forEach(btn => {
    btn.addEventListener('click', function() {
      const target = this.dataset.backPanel;
      if(target === 'parent') {
        showPanel(parentPanel);
      } else if(target === 'child') {
        showPanel(childPanel);
      }
    });
  });

  // Navigate to child / grandchild panels
  parentPanel.querySelectorAll('.menu__link').forEach(link => {
    link.addEventListener('click', function(e) {
      const children = this.closest('.menu__item').querySelector('ul');
      if(children) {
        e.preventDefault();
        populatePanel(childPanel, children, this.dataset.title);
        showPanel(childPanel);
      }
    });
  });

  childPanel.addEventListener('click', function(e) {
    const targetItem = e.target.closest('.menu__item.has-children');
    if(targetItem) {
      const children = targetItem.querySelector('ul');
      if(children) {
        populatePanel(grandchildPanel, children, targetItem.querySelector('.menu__link').textContent);
        showPanel(grandchildPanel);
      }
    }
  });

  function showPanel(panel) {
    panels.forEach(p => p.classList.remove('active'));
    panel.classList.add('active');
  }

  function populatePanel(panel, content, title) {
    panel.querySelector('.drawer__panel-title').textContent = title;
    const list = panel.querySelector('ul');
    list.innerHTML = content.innerHTML;
  }
});
</script>
