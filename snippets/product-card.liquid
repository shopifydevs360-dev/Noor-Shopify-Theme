{% comment %}
  Renders a single product card for the collection grid.

  Accepts:
  - product: {Object} Product object.
  - show_vendor: {Boolean} Show the product vendor.

  Usage:
  {% render 'product-card', product: product, show_vendor: section.settings.show_vendor %}
{% endcomment %}

<div class="product-card border-radius-style-two" data-product-id="{{ product.id }}">
  <div class="product-card__media">
    <a href="{{ product.url }}" class="product-card__link" title="{{ product.title | escape }}">
      {% if product.featured_image %}
        <img
          srcset="{%- if product.featured_image.width >= 165 -%}{{ product.featured_image | img_url: '165x' }} 165w,{%- endif -%}
                  {%- if product.featured_image.width >= 360 -%}{{ product.featured_image | img_url: '360x' }} 360w,{%- endif -%}
                  {%- if product.featured_image.width >= 533 -%}{{ product.featured_image | img_url: '533x' }} 533w,{%- endif -%}
                  {%- if product.featured_image.width >= 720 -%}{{ product.featured_image | img_url: '720x' }} 720w,{%- endif -%}
                  {%- if product.featured_image.width >= 940 -%}{{ product.featured_image | img_url: '940x' }} 940w,{%- endif -%}
                  {%- if product.featured_image.width >= 1066 -%}{{ product.featured_image | img_url: '1066x' }} 1066w{%- endif -%}"
          src="{{ product.featured_image | img_url: '533x' }}"
          sizes="(min-width: 1100px) 535px, (min-width: 750px) calc((100vw - 130px) / 2), calc((100vw - 50px) / 2)"
          alt="{{ product.featured_image.alt | escape }}"
          class="product-card__image"
          loading="lazy"
          width="{{ product.featured_image.width }}"
          height="{{ product.featured_image.height }}"
        >
      {% else %}
        {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg product-card__image' }}
      {% endif %}
    </a>

    {% if product.compare_at_price > product.price %}
      <span class="product-card__badge product-card__badge--sale">Sale</span>
    {% elsif product.available == false %}
      <span class="product-card__badge product-card__badge--sold-out">Sold Out</span>
    {% endif %}

    <div class="product-card__actions">
      {% if product.available %}
        {% form 'product', product, id: "product-form-#{product.id}", class: "product-form", novalidate: 'novalidate', data-type: 'add-to-cart-form' %}
          <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
          
          {% if settings.cart_behavior == 'redirect' %}
            <!-- Traditional form submission -->
            <button type="submit" class="action-btn" title="Add to Cart">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                <circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
              </svg>
            </button>
          {% else %}
            <!-- Ajax add to cart -->
            <button type="submit" class="action-btn add-to-cart-js" title="Add to Cart">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                <circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
              </svg>
            </button>
          {% endif %}
        {% endform %}
      {% endif %}
      
      <button class="action-btn wishlist-btn" title="Add to Wishlist">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" focusable="false">
          <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
        </svg>
      </button>
    </div>
  </div>
  
  <div class="product-card__info">
    {% if show_vendor %}
      <div class="product-card__vendor">{{ product.vendor }}</div>
    {% endif %}
    
    <h3 class="product-card__title h5">
      <a href="{{ product.url }}">{{ product.title | truncate: 50 }}</a>
    </h3>
    
    {% comment %}
      Rating display - Integrate with your review app here.
      This is a basic star display using a metafield.
    {% endcomment %}
    {%- if product.metafields.reviews.rating.value != blank -%}
      <div class="product-card__rating">
        <div class="stars" style="--rating: {{ product.metafields.reviews.rating.value }};" aria-label="Rating of {{ product.metafields.reviews.rating.value }} out of 5.">
          <span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
        </div>
        <span class="rating-count">({{ product.metafields.reviews.count.value }})</span>
      </div>
    {%- endif -%}
    
    <div class="product-card__price">
      {% if product.compare_at_price > product.price %}
        <span class="price-original">{{ product.compare_at_price | money }}</span>
        <span class="price-current">{{ product.price | money }}</span>
      {% else %}
        <span class="price-current">{{ product.price | money }}</span>
      {% endif %}
    </div>
  </div>
</div>