{%- liquid
  if product == blank
    break
  endif

  assign featured_media = product.featured_media
  assign media_count = product.media.size
-%}

<div class="product-media">

  {% if media_count == 0 %}
    <p>No media available</p>
  {% else %}

    <!-- MAIN MEDIA -->
    <div class="product-media__main">
      {% if featured_media.media_type contains 'video' %}
        {{ featured_media | video_tag:
          autoplay: true,
          loop: true,
          muted: true,
          controls: false,
          playsinline: true
        }}
      {% else %}
        <img
          src="{{ featured_media | image_url: width: 1200 }}"
          alt="{{ featured_media.alt | escape }}"
          class="js-zoom-image"
          loading="eager">
      {% endif %}
    </div>

    <!-- VIDEO ROW -->
    {% assign has_video = false %}
    {% for media in product.media %}
      {% if media.media_type contains 'video' %}
        {% assign has_video = true %}
      {% endif %}
    {% endfor %}

    {% if has_video %}
      <div class="product-media__video-row">
        {% for media in product.media %}
          {% if media.media_type contains 'video' %}
            <div class="product-media__video">
              {{ media | video_tag:
                autoplay: true,
                loop: true,
                muted: true,
                controls: false,
                playsinline: true
              }}
            </div>
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}

    <!-- IMAGE SLIDER -->
    {% if media_count > 1 %}
      <div class="product-media__thumbs swiper">
        <div class="swiper-wrapper">

          {% for media in product.media %}
            {% if media.media_type == 'image' and media.id != featured_media.id %}
              <div class="swiper-slide">
                <img
                  src="{{ media | image_url: width: 1200 }}"
                  alt="{{ media.alt | escape }}"
                  data-full="{{ media | image_url: width: 1200 }}"
                  class="js-thumb">
              </div>
            {% endif %}
          {% endfor %}

          {% if featured_media.media_type == 'image' %}
            <div class="swiper-slide">
              <img
                src="{{ featured_media | image_url: width: 1200 }}"
                alt="{{ featured_media.alt | escape }}"
                data-full="{{ featured_media | image_url: width: 1200 }}"
                class="js-thumb is-featured">
            </div>
          {% endif %}

        </div>

        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-pagination"></div>
      </div>
    {% endif %}

  {% endif %}
</div>
