{%- liquid
  if product == blank
    echo 'Product media unavailable'
    break
  endif

  assign featured_media = product.featured_media
  assign media_count = product.media.size
-%}

<div class="product-media">

  {%- if media_count == 0 -%}
    <p>No media available</p>
  {%- else -%}

    <!-- =====================
         MAIN MEDIA
    ====================== -->
    <div class="product-media__main">

      {% if featured_media.media_type contains 'video' %}
        {{ featured_media | video_tag: controls: true, autoplay: false }}
      {% elsif featured_media.media_type == 'image' %}
        <img
          src="{{ featured_media | image_url: width: 1200 }}"
          alt="{{ featured_media.alt | escape }}"
          class="js-zoom-image"
          loading="eager">
      {% endif %}

    </div>

    <!-- =====================
         VIDEO ROW (IF EXISTS)
    ====================== -->
    {% assign has_video = false %}
    {% for media in product.media %}
      {% if media.media_type contains 'video' %}
        {% assign has_video = true %}
      {% endif %}
    {% endfor %}

    {% if has_video %}
      <div class="product-media__video-row">
        {% for media in product.media %}
          {% if media.media_type contains 'video' %}
            <div class="product-media__video">
              {{ media | video_tag: controls: true }}
            </div>
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}

    <!-- =====================
         IMAGE THUMB SLIDER
    ====================== -->
{% if media_count > 1 %}
  <div class="product-media__thumbs swiper">
    <div class="swiper-wrapper">

      {%- comment -%} OTHER IMAGES FIRST (EXCEPT FEATURED) {%- endcomment -%}
      {% for media in product.media %}
        {% if media.media_type == 'image' and media.id != featured_media.id %}
          <div class="swiper-slide">
            <img
              src="{{ media | image_url: width: 1200 }}"
              alt="{{ media.alt | escape }}"
              data-full="{{ media | image_url: width: 1200 }}"
              class="js-thumb">
          </div>
        {% endif %}
      {% endfor %}

      {%- comment -%} FEATURED IMAGE LAST {%- endcomment -%}
      {% if featured_media.media_type == 'image' %}
        <div class="swiper-slide">
          <img
            src="{{ featured_media | image_url: width: 1200 }}"
            alt="{{ featured_media.alt | escape }}"
            data-full="{{ featured_media | image_url: width: 1200 }}"
            class="js-thumb is-featured">
        </div>
      {% endif %}

    </div>

    <!-- NAVIGATION -->
    <div class="swiper-button-prev"></div>
    <div class="swiper-button-next"></div>

    <!-- PAGINATION -->
    <div class="swiper-pagination"></div>
  </div>
{% endif %}


  {%- endif -%}

</div>
