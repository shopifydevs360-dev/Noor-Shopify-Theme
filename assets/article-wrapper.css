if ($(".featured-posts.js-pinned-sections").length > 0) {
  const panels = gsap.utils.toArray(
    ".featured-posts .js-pin-panel-wrap"
  );

  const totalScroll = panels.length * 1000;
  const step = totalScroll / panels.length;

  // Initial state
  gsap.set(panels.slice(1), { autoAlpha: 0, y: 40 });

  panels.forEach((panel, index) => {
    const isFirst = index === 0;
    const isLast = index === panels.length - 1;

    ScrollTrigger.create({
      trigger: ".featured-posts.js-pinned-sections",
      start: "top -=" + step * index,
      end: "+=" + step,

      onEnter: () => {
        gsap.to(panel, { autoAlpha: 1, y: 0, duration: 0.6 });

        $(".featured-post-count .active-counter").removeClass(
          "active-counter"
        );
        $(
          `.featured-post-count [data-counter-index="${index}"]`
        ).addClass("active-counter");
      },

      onEnterBack: () => {
        gsap.to(panel, { autoAlpha: 1, y: 0, duration: 0.6 });

        $(".featured-post-count .active-counter").removeClass(
          "active-counter"
        );
        $(
          `.featured-post-count [data-counter-index="${index}"]`
        ).addClass("active-counter");
      },

      onLeave: () => {
        if (!isLast) {
          gsap.to(panel, { autoAlpha: 0, y: -20, duration: 0.4 });
        }
      },

      onLeaveBack: () => {
        if (!isFirst) {
          gsap.to(panel, { autoAlpha: 0, y: -20, duration: 0.4 });
        }
      }
    });
  });

  // Pin the entire section
  ScrollTrigger.create({
    trigger: ".featured-posts.js-pinned-sections",
    start: "top center",
    end: "+=" + totalScroll,
    pin: true,
    scrub: true,
    markers: false
  });
}
